"use strict";var errorObj=require("./constant");function RequestPool(e){var t=this;this.maxRequestNum=e||3,this.currentRequestNum=0,this.requestQueue=[],this.done=function(e){if("[object Function]"!==Object.prototype.toString.call(e))throw new Error(errorObj.doneCbError);t.doneCb=e},this.push=function(e){if(t.currentRequestNum<t.maxRequestNum){var r=e();if(!r instanceof Promise)throw new Error(errorObj.insError);t.currentRequestNum++,r.finally(function(){var e;t.currentRequestNum--,0!==t.requestQueue.length&&(e=t.requestQueue.pop(),t.push(e)),0===t.currentRequestNum&&t.doneCb&&t.doneCb()})}else t.requestQueue.unshift(e)}}module.exports=RequestPool;